package com.weidi.chat;

import org.jivesoftware.smack.XMPPConnection;
import org.jivesoftware.smack.packet.IQ;
import org.jivesoftware.smack.packet.Presence;
import org.jivesoftware.smack.provider.ProviderManager;

import android.util.Log;

import com.weidi.QApp;
import com.weidi.provider.CreateMUCIQ;
import com.weidi.provider.CreateMUCProvider;
import com.weidi.provider.EntryMUCPresence;
import com.weidi.provider.ObtainMUCAddmemberIQ;
import com.weidi.provider.ObtainMUCAddmemberProvider;
import com.weidi.provider.ObtainMUCChangInfoIQ;
import com.weidi.provider.ObtainMUCChangInfoProvider;
import com.weidi.provider.ObtainMUCChangNickIQ;
import com.weidi.provider.ObtainMUCChangNickProvider;
import com.weidi.provider.ObtainMUCCreateGroupIQ;
import com.weidi.provider.ObtainMUCCreateGroupProvider;
import com.weidi.provider.ObtainMUCDestroyIQ;
import com.weidi.provider.ObtainMUCDestroyProvider;
import com.weidi.provider.ObtainMUCExitIQ;
import com.weidi.provider.ObtainMUCExitProvider;
import com.weidi.provider.ObtainMUCmemberIQ;
import com.weidi.provider.ObtainMUCmemberProvider;
import com.weidi.provider.ObtainMUCInfoIQ;
import com.weidi.provider.ObtainMUCInfoProvider;
import com.weidi.provider.ObtainMUCKickIQ;
import com.weidi.provider.ObtainMUCKickProvider;
import com.weidi.provider.ObtainMUCListIQ;
import com.weidi.provider.ObtainMUCListProvider;
import com.weidi.util.Const;

/**
 *@author  luochangdong  E-mail: 2270333671@qq.com
 *@date 创建时间：2015-7-9 下午1:54:50
 *@Description 1.0
 */
public class ChatGroupOrder {

	private static ChatGroupOrder instance;
	private XMPPConnection conn = QApp.xmppConnection;
	private ProviderManager pm = ProviderManager.getInstance();
	
	
	public static ChatGroupOrder getInstance(){
		if(instance == null){
			instance = new ChatGroupOrder();
		}
		return instance;
	}
	
	/**
	 * 创建群
	 * @param mucName
	 * @param description
	 * @param usernick
	 */
	public void createMUCRoom(String mucName,String description,String usernick){
		CreateMUCIQ iq = new CreateMUCIQ(mucName,
				description, usernick);
		iq.setType(IQ.Type.SET);
		pm.addIQProvider(Const.QUERY, Const.XMLNS, new CreateMUCProvider());
		conn.sendPacket(iq);
	}
	
	/**获取群列表
	 * @param muc
	 */
	public void obtainMUCList(){
		pm.addIQProvider(Const.QUERY, Const.XMLNS, new ObtainMUCListProvider());
		ObtainMUCListIQ iq = new ObtainMUCListIQ();
		iq.setType(IQ.Type.GET);
		Log.i("TAG", iq.toXML());
		conn.sendPacket(iq);
		
	}
	
	/**
	 * 获取指定群信息
	 * @param muc
	 */
	public void obtainMUCInfo(String muc){
        pm.addIQProvider(Const.QUERY, Const.XMLNS, new ObtainMUCInfoProvider());
		ObtainMUCInfoIQ iq = new ObtainMUCInfoIQ();
		iq.setMuc(muc);
		iq.setType(IQ.Type.GET);
		Log.i("TAG", iq.toXML());
		QApp.xmppConnection.sendPacket(iq);
	}
	
	
	/**修改群信息
	 * @param muc
	 * @param name
	 * @param description
	 */
	public void mucChangInfo(String muc, String name,String description){
		pm.addIQProvider(Const.QUERY, Const.XMLNS, new ObtainMUCChangInfoProvider());
		ObtainMUCChangInfoIQ iq = new ObtainMUCChangInfoIQ();
		iq.setType(IQ.Type.SET);
		iq.setMuc(muc);
		iq.setName(name);
		iq.setDescription(description);
		Log.i("TAG", iq.toXML());
		conn.sendPacket(iq);
		
	}
	public void entryMUCRoom(String muc,String weidi){
		Presence presence = new Presence(Presence.Type.available);
		EntryMUCPresence entryPresence = new EntryMUCPresence();
		
		presence.setTo(muc+"@conference.jsmny/"+weidi);
		presence.addExtension(entryPresence);

	    QApp.xmppConnection.sendPacket(presence);
	}
	
	/**销毁群
	 * @param muc
	 * 
	 */
	public void mucDestroy(String muc){
		pm.addIQProvider(Const.QUERY, Const.XMLNS, new ObtainMUCDestroyProvider());
		ObtainMUCDestroyIQ iq = new ObtainMUCDestroyIQ();
		iq.setType(IQ.Type.SET);
		iq.setMuc(muc);
		Log.i("TAG", iq.toXML());
		conn.sendPacket(iq);
		
	}
	
	
	/**退出群
	 * @param muc
	 * 
	 */
	public void mucExit(String muc){
		pm.addIQProvider(Const.QUERY, Const.XMLNS, new ObtainMUCExitProvider());
		ObtainMUCExitIQ iq = new ObtainMUCExitIQ();
		iq.setType(IQ.Type.SET);
		iq.setMuc(muc);
		Log.i("TAG", iq.toXML());
		conn.sendPacket(iq);
		
	}
	
	
	/**踢人
	 * @param muc
	 * 
	 */
	public void mucKick(String muc,String jid){
		pm.addIQProvider(Const.QUERY, Const.XMLNS, new ObtainMUCKickProvider());
		ObtainMUCKickIQ iq = new ObtainMUCKickIQ();
		iq.setType(IQ.Type.SET);
		iq.setMuc(muc);
		iq.setJid(jid);
		Log.i("TAG", iq.toXML());
		conn.sendPacket(iq);
		
	}
	
	
	/**添加好友
	 * @param muc
	 * @param jid
	 * @param nick
	 */
	public void mucAddmember(String muc,String jid,String nick){
		pm.addIQProvider(Const.QUERY, Const.XMLNS, new ObtainMUCAddmemberProvider());
		ObtainMUCAddmemberIQ iq = new ObtainMUCAddmemberIQ();
		iq.setType(IQ.Type.SET);
		iq.setMuc(muc);
		iq.setJid(jid);
		iq.setNick(nick);
		conn.sendPacket(iq);
		
	}
	
	
	/**获取群成员列表
	 * @param muc
	 * 
	 */
	public void obtainMUCGetmember(String muc){
		pm.addIQProvider(Const.QUERY, Const.XMLNS, new ObtainMUCmemberProvider());
		ObtainMUCmemberIQ iq = new ObtainMUCmemberIQ();
		iq.setType(IQ.Type.GET);
		iq.setMuc(muc);
		Log.i("TAG", iq.toXML());
		conn.sendPacket(iq);
		
	}
	/**修改群呢称
	 * @param muc
	 * @param nickname
	 */
	public void mucChangNick(String muc, String nickname){
		pm.addIQProvider(Const.QUERY, Const.XMLNS, new ObtainMUCChangNickProvider());
		ObtainMUCChangNickIQ iq = new ObtainMUCChangNickIQ();
		iq.setType(IQ.Type.SET);
		iq.setMuc(muc);
		iq.setNickname(nickname);
		Log.i("TAG", iq.toXML());
		conn.sendPacket(iq);
		
	}
	
}
