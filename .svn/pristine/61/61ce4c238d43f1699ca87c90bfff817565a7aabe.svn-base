package com.weidi.db;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import android.content.ContentValues;
import android.content.Context;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteOpenHelper;
import android.util.Log;

public class DBContext {
    public DBHelper1 dbHelper;
	SQLiteDatabase sqLiteDatabase = null; 
	public DBContext(Context context) {
	  										
		try {
            String sql ="create table if not exists Vcard(" +
                    " _id integer primary key autoincrement," +
                    " iv_avater varchar(100)  null," +
                    " nickname varchar(50)  null," +
                    " sex varchar(10)  null," +
                    " account varchar(50)  null," +
                    " sign varchar(50) null," +
                    " region varchar(50)  null)";
                   
            dbHelper = new DBHelper1(context);
            sqLiteDatabase = dbHelper.getWritableDatabase();
            sqLiteDatabase.execSQL(sql);
          
        } catch (Exception e) {
            // TODO: handle exception
        } finally {
            if (sqLiteDatabase != null) {
                sqLiteDatabase.close();
            }
            if (dbHelper != null) {
                dbHelper.close();
            }
        }
	}
	
	public int insert(ContentValues values){
		
		SQLiteDatabase db=
		dbHelper.getWritableDatabase();
		
		int id=(int)db.insert("Vcard",null, values);//�����nullֵ���ǵ������е�ֵΪnull�Ǵ��е����Ϊnull
		Log.i("TAG", "insert ok!");
		
		db.close();
		return id;
	}
	
    public void delete(String id){
    	
		SQLiteDatabase db=
		dbHelper.getWritableDatabase();
		
		db.delete("Vcard","_id=?",new String[]{id});
		Log.i("TAG", "delete ok!");
		
		db.close();	
	}
    
    public int update(ContentValues values){
       
        SQLiteDatabase db=
        dbHelper.getWritableDatabase();
       
        int id=(int)db.update("Vcard", values, null, null);
        
        Log.i("TAG", "update ok!");
       
        db.close();
        return id;
    }
   
   public List<Map<String,Object>> query(){
		SQLiteDatabase db=
		dbHelper.getReadableDatabase();
		 Cursor c=db.query(
		"Vcard", new String[]{"_id","iv_avater","nickname","sex","sign","region"},
	     null, null, null, null, null);
		 List<Map<String,Object>> list=
		 new ArrayList<Map<String,Object>>();
		 Map<String,Object> map=null;
		 while(c.moveToNext()){
			 map=new HashMap<String, Object>();
			 map.put("_id", c.getInt(0));
			 map.put("iv_avater",c.getString(1));
			 map.put("nickname",c.getString(2));
			 map.put("sex",c.getString(3));
			 map.put("sign",c.getString(4));
			 map.put("region",c.getString(5));			 
			 list.add(map);
		 }
		Log.i("TAG", "list="+list);
		return list;
	}
	private class DBHelper1 extends SQLiteOpenHelper{
	
	    public DBHelper1(Context context) {
			super(context, "Vcard.db", null, 1);
			Log.i("TAG", "onCreate()");
		}
	   
		@Override
	  	public void onCreate(SQLiteDatabase db) {

	  	}
        @Override
        public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
            // TODO Auto-generated method stub
            
        }
	   
	}
}
/**
 * View (EditText,button)
 * -----------------------
 * Activity
 *   |-->��ʼ��view
 *   |-->���view���
 *   |-->����ݽ���У��
 *   |-->����ݴ���DBcontext
 * -----------------------
 * DBContext(��װ��ݲ���)
 *   |-->SQLiteOpenHelper
 *   |-->SQLiteDataBase
 * -----------------------
 * SQlite (DBMS)
 */